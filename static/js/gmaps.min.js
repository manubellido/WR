var GMaps=function(n){var q=function(b){var e=this;window.context_menu={};this.div=n(b.div)[0];this.controls=[];this.overlays=[];this.markers=[];this.polylines=[];this.routes=[];this.polygons=[];this.overlay_div=this.infoWindow=null;this.zoom=b.zoom||15;var i;i=b.mapType?google.maps.MapTypeId[b.mapType.toUpperCase()]:google.maps.MapTypeId.ROADMAP;var p=new google.maps.LatLng(b.lat,b.lng);delete b.lat;delete b.lng;delete b.mapType;i=n.extend({zoom:this.zoom,center:p,mapTypeId:i},b);this.map=new google.maps.Map(this.div,
i);var m=function(a,c){var d="",g=window.context_menu[a];for(var f in g)if(g.hasOwnProperty(f))d+='<li><a id="'+a+"_"+f+'" href="#">'+g[f].title+"</a></li>";f=n("#gmaps_context_menu");f.html(d);f.undelegate();f.delegate("li a","click",function(h){h.preventDefault();g[n(this).attr("id").replace(a+"_","")].action.call(e,c);e.hideContextMenu()});d=n(e.div).offset().left+c.pixel.x-15;var j=n(e.div).offset().top+c.pixel.y-15;f.css({left:d,top:j}).fadeIn(200)},o=function(a,c){if(a==="marker"){c.pixel={};
var d=new google.maps.OverlayView;d.setMap(e.map);d.draw=function(){var g=d.getProjection(),f=c.marker.getPosition();c.pixel=g.fromLatLngToContainerPixel(f);m(a,c)}}else m(a,c)};this.setContextMenu=function(a){window.context_menu[a.control]={};for(var c in a.options)if(a.options.hasOwnProperty(c)){var d=a.options[c];window.context_menu[a.control][d.name]={title:d.title,action:d.action}}n("body").append('<ul id="gmaps_context_menu" style="position:absolute;display:none;min-width:100px;background:white;list-style:none;padding:8px;box-shadow:2px 2px 6px #ccc"></ul>');
n("#gmaps_context_menu").mouseleave(function(){n(this).delay(100).fadeOut(200)})};this.hideContextMenu=function(){n("#gmaps_context_menu").fadeOut(200)};google.maps.event.addListener(this.map,"bounds_changed",function(a){b.bounds_changed&&b.bounds_changed(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"center_changed",function(a){b.center_changed&&b.center_changed(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"click",function(a){b.click&&b.click(a);e.hideContextMenu()});
google.maps.event.addListener(this.map,"dblclick",function(a){b.dblclick&&b.dblclick(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"drag",function(a){b.drag&&b.drag(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"dragend",function(a){b.dragend&&b.dragend(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"dragstart",function(a){b.dragstart&&b.dragstart(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"idle",function(a){b.idle&&b.idle(a);
e.hideContextMenu()});google.maps.event.addListener(this.map,"maptypeid_changed",function(a){b.maptypeid_changed&&b.maptypeid_changed(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"mousemove",function(a){b.mousemove&&b.mousemove(a)});google.maps.event.addListener(this.map,"mouseout",function(a){b.mouseout&&b.mouseout(a)});google.maps.event.addListener(this.map,"mouseover",function(a){b.mouseover&&b.mouseover(a)});google.maps.event.addListener(this.map,"projection_changed",function(a){b.projection_changed&&
b.projection_changed(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"resize",function(a){b.resize&&b.resize(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"rightclick",function(a){b.rightclick&&b.rightclick(a);o("map",a)});google.maps.event.addListener(this.map,"tilesloaded",function(a){b.tilesloaded&&b.tilesloaded(a);e.hideContextMenu()});google.maps.event.addListener(this.map,"zoom_changed",function(a){b.zoom_changed&&b.zoom_changed(a);e.hideContextMenu()});this.setCenter=
function(a,c,d){this.map.panTo(new google.maps.LatLng(a,c));d&&d()};this.getCenter=function(){return this.map.getCenter()};this.getDiv=function(){return this.div};this.setZoom=function(a){this.map.setZoom(a)};this.zoomIn=function(a){this.map.setZoom(this.map.getZoom()+a)};this.zoomOut=function(a){this.map.setZoom(this.map.getZoom()-a)};this.createControl=function(a){a.style.cursor="pointer";a.style.fontFamily="Arial, sans-serif";a.style.fontSize="13px";a.style.boxShadow="rgba(0, 0, 0, 0.398438) 0px 2px 4px";
var c=n("<div></div>");c.css(a.style);c.text(a.text);c=c[0];for(var d in a.events)google.maps.event.addDomListener(c,d,function(){a.events[d].apply(this,[this])});c.index=1;return c};this.addControl=function(a){var c=google.maps.ControlPosition[a.position.toUpperCase()];delete a.position;a=this.createControl(a);this.controls.push(a);this.map.controls[c].push(a);return a};this.createMarker=function(a){if(a.lat&&a.lng){var c=this,d=a.details,g=a.fences,f=a.outside,j={position:new google.maps.LatLng(a.lat,
a.lng),map:null};delete a.lat;delete a.lng;delete a.fences;delete a.outside;j=n.extend(j,a);var h=new google.maps.Marker(j);h.fences=g;if(a.infoWindow){h.infoWindow=new google.maps.InfoWindow(a.infoWindow);a.infoWindow.closeclick&&google.maps.event.addListener(h.infoWindow,"closeclick",function(){a.infoWindow.closeclick()});a.infoWindow.content_changed&&google.maps.event.addListener(h.infoWindow,"content_changed",function(){a.infoWindow.content_changed()});a.infoWindow.domready&&google.maps.event.addListener(h.infoWindow,
"domready",function(){a.infoWindow.domready()});a.infoWindow.position_changed&&google.maps.event.addListener(h.infoWindow,"position_changed",function(){a.infoWindow.position_changed()});a.infoWindow.zindex_changed&&google.maps.event.addListener(h.infoWindow,"zindex_changed",function(){a.infoWindow.zindex_changed()})}google.maps.event.addListener(h,"click",function(){this.details=d;a.click&&a.click.apply(this,[this]);if(h.infoWindow){c.hideInfoWindows();h.infoWindow.open(c.map,h)}});a.drag&&google.maps.event.addListener(h,
"drag",function(){a.drag(this)});if(a.dragend||h.fences)google.maps.event.addListener(h,"dragend",function(){a.dragend&&a.dragend(this);h.fences&&c.checkMarkerGeofence(h,function(r,s){f(r,s)})});a.dragstart&&google.maps.event.addListener(h,"dragstart",function(){a.dragstart(this)});a.mouseout&&google.maps.event.addListener(h,"mouseout",function(){a.mouseout(this)});a.mouseover&&google.maps.event.addListener(h,"mouseover",function(){a.mouseover(this)});a.mouseup&&google.maps.event.addListener(h,"mouseup",
function(){a.mouseup(this)});a.position_changed&&google.maps.event.addListener(h,"position_changed",function(){a.position_changed(this)});return h}else throw"No latitude or longitude defined";};this.addMarker=function(a){if(a.lat&&a.lng){a=this.createMarker(a);a.setMap(this.map);this.markers.push(a);return a}else throw"No latitude or longitude defined";};this.addMarkers=function(a){for(var c=0,d;d=a[c];c++)this.addMarker(d);return this.markers};this.hideInfoWindows=function(){for(var a=0,c;c=this.markers[a];a++)c.infoWindow&&
c.infoWindow.close()};this.removeMarkers=function(){for(var a=0,c;c=this.markers[a];a++)c.setMap(null);this.markers=[]};this.drawOverlay=function(a){var c=new google.maps.OverlayView;c.setMap(e.map);c.onAdd=function(){var d=document.createElement("div");d.style.borderStyle="none";d.style.borderWidth="0px";d.style.position="absolute";d.innerHTML=a.content;e.overlay_div=d;var g=this.getPanes();if(!a.layer)a.layer="overlayLayer";g[a.layer].appendChild(d)};c.draw=function(){var d=this.getProjection().fromLatLngToDivPixel(new google.maps.LatLng(a.lat,
a.lng));a.horizontalOffset=a.horizontalOffset||0;a.verticalOffset=a.verticalOffset||0;var g=e.overlay_div,f=g.children;switch(a.verticalAlign){case "top":g.style.top=d.y-n(f).height()+a.verticalOffset+"px";break;default:case "middle":g.style.top=d.y-n(f).height()/2+a.verticalOffset+"px";break;case "bottom":g.style.top=d.y+a.verticalOffset+"px";break}switch(a.horizontalAlign){case "left":g.style.left=d.x-n(f).width()+a.horizontalOffset+"px";break;default:case "center":g.style.left=d.x-n(f).width()/
2+a.horizontalOffset+"px";break;case "right":g.style.left=d.x+a.horizontalOffset+"px";break}};c.onRemove=function(){e.overlay_div.parentNode.removeChild(e.overlay_div);e.overlay_div=null};e.overlays.push(c);return c};this.removeOverlay=function(a){a.setMap(null)};this.removeOverlays=function(){for(var a=0,c;c=e.overlays[a];a++)c.setMap(null);e.overlays=[]};this.drawPolyline=function(a){var c=[],d=a.path;if(d.length)if(d[0][0]===undefined)c=d;else for(var g=0,f;f=d[g];g++)c.push(new google.maps.LatLng(f[0],
f[1]));c=new google.maps.Polyline({map:this.map,path:c,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});a.click&&google.maps.event.addListener(c,"click",function(j){a.click(j)});a.dblclick&&google.maps.event.addListener(c,"dblclick",function(j){a.dblclick(j)});a.mousedown&&google.maps.event.addListener(c,"mousedown",function(j){a.mousedown(j)});a.mousemove&&google.maps.event.addListener(c,"mousemove",function(j){a.mousemove(j)});a.mouseout&&google.maps.event.addListener(c,
"mouseout",function(j){a.mouseout(j)});a.mouseover&&google.maps.event.addListener(c,"mouseover",function(j){a.mouseover(j)});a.mouseup&&google.maps.event.addListener(c,"mouseup",function(j){a.mouseup(j)});a.rightclick&&google.maps.event.addListener(c,"rightclick",function(j){a.rightclick(j)});this.polylines.push(c);return c};this.drawCircle=function(a){a=n.extend({map:this.map,center:new google.maps.LatLng(a.lat,a.lng)},a);delete a.lat;delete a.lng;var c=new google.maps.Circle(a);google.maps.event.addListener(c,
"click",function(d){a.click&&a.click(d)});google.maps.event.addListener(c,"dblclick",function(d){a.dblclick&&a.dblclick(d)});google.maps.event.addListener(c,"mousedown",function(d){a.mousedown&&a.mousedown(d)});google.maps.event.addListener(c,"mousemove",function(d){a.mousemove&&a.mousemove(d)});google.maps.event.addListener(c,"mouseout",function(d){a.mouseout&&a.mouseout(d)});google.maps.event.addListener(c,"mouseover",function(d){a.mouseover&&a.mouseover(d)});google.maps.event.addListener(c,"mouseup",
function(d){a.mouseup&&a.mouseup(d)});google.maps.event.addListener(c,"rightclick",function(d){a.rightclick&&a.rightclick(d)});return c};this.drawPolygon=function(a){a=n.extend({map:this.map},a);var c=new google.maps.Polygon(a);google.maps.event.addListener(c,"click",function(d){a.click&&a.click(d)});google.maps.event.addListener(c,"dblclick",function(d){a.dblclick&&a.dblclick(d)});google.maps.event.addListener(c,"mousedown",function(d){a.mousedown&&a.mousedown(d)});google.maps.event.addListener(c,
"mousemove",function(d){a.mousemove&&a.mousemove(d)});google.maps.event.addListener(c,"mouseout",function(d){a.mouseout&&a.mouseout(d)});google.maps.event.addListener(c,"mouseover",function(d){a.mouseover&&a.mouseover(d)});google.maps.event.addListener(c,"mouseup",function(d){a.mouseup&&a.mouseup(d)});google.maps.event.addListener(c,"rightclick",function(d){a.rightclick&&a.rightclick(d)});this.polygons.push(c);return c};var k,l;this.getRoutes=function(a){switch(a.travelMode){case "bicycling":k=google.maps.TravelMode.BICYCLING;
break;case "driving":k=google.maps.TravelMode.DRIVING;break;default:k=google.maps.TravelMode.WALKING;break}l=a.unitSystem==="imperial"?google.maps.UnitSystem.IMPERIAL:google.maps.UnitSystem.METRIC;var c=n.extend({avoidHighways:true,avoidTolls:true,optimizeWaypoints:true,waypoints:[]},a);c.origin=new google.maps.LatLng(a.origin[0],a.origin[1]);c.destination=new google.maps.LatLng(a.destination[0],a.destination[1]);c.travelMode=k;c.unitSystem=l;delete c.callback;var d=this;(new google.maps.DirectionsService).route(c,
function(g,f){if(f===google.maps.DirectionsStatus.OK)for(var j in g.routes)g.routes.hasOwnProperty(j)&&d.routes.push(g.routes[j]);a.callback&&a.callback(d.routes)})};this.drawRoute=function(a){var c=this;this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,callback:function(d){if(d.length>0){c.drawPolyline({path:d[d.length-1].overview_path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});a.callback&&a.callback(d[d.length-1])}}})};this.travelRoute=
function(a){if(a.origin&&a.destination)this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,callback:function(f){if(f.length>0&&a.step){f=f[f.length-1];if(f.legs.length>0){f=f.legs[0].steps;for(var j=0,h;h=f[j];j++){h.step_number=j;a.step(h)}}}}});else if(a.route)if(a.route.legs.length>0)for(var c=a.route.legs[0].steps,d=0,g;g=c[d];d++){g.step_number=d;a.step(g)}};this.drawSteppedRoute=function(a){if(a.origin&&a.destination)this.getRoutes({origin:a.origin,destination:a.destination,
travelMode:a.travelMode,callback:function(f){if(f.length>0&&a.step){f=f[f.length-1];if(f.legs.length>0){f=f.legs[0].steps;for(var j=0,h;h=f[j];j++){h.step_number=j;e.drawPolyline({path:h.path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});a.step(h)}}}}});else if(a.route)if(a.route.legs.length>0)for(var c=a.route.legs[0].steps,d=0,g;g=c[d];d++){g.step_number=d;e.drawPolyline({path:g.path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});
a.step(g)}};this.checkGeofence=function(a,c,d){return d.containsLatLng(new google.maps.LatLng(a,c))};this.checkMarkerGeofence=function(a,c){if(a.fences)for(var d=0,g;g=a.fences[d];d++){var f=a.getPosition();e.checkGeofence(f.lat(),f.lng(),g)||c(a,g)}}};q.Route=function(b){this.map=b.map;this.route=b.route;this.step_count=0;this.steps=this.route.legs[0].steps;this.steps_length=this.steps.length;this.polyline=this.map.drawPolyline({path:new google.maps.MVCArray,strokeColor:b.strokeColor,strokeOpacity:b.strokeOpacity,
strokeWeight:b.strokeWeight}).getPath();this.back=function(){if(this.step_count>0){this.step_count--;var e=this.route.legs[0].steps[this.step_count].path;for(var i in e)e.hasOwnProperty(i)&&this.polyline.pop()}};this.forward=function(){if(this.step_count<this.steps_length){var e=this.route.legs[0].steps[this.step_count].path;for(var i in e)e.hasOwnProperty(i)&&this.polyline.push(e[i]);this.step_count++}}};q.geolocate=function(b){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(e){b.success(e);
b.always&&b.always()},function(e){b.error(e);b.always&&b.always()},b.options);else{b.not_supported();b.always&&b.always()}};q.geocode=function(b){this.geocoder=new google.maps.Geocoder;var e=b.callback;if(b.lat&&b.lng)b.latLng=new google.maps.LatLng(b.lat,b.lng);delete b.lat;delete b.lng;delete b.callback;this.geocoder.geocode(b,function(i,p){e(i,p)})};q.staticMapURL=function(b){function e(a,c){if(a[0]==="#"){a=a.replace("#","0x");if(c){c=parseFloat(c);c=Math.min(1,Math.max(c,0));if(c===0)return"0x00000000";
c=(c*255).toString(16);if(c.length===1)c+=c;a=a.slice(0,8)+c}}return a}var i=[],p="https://maps.googleapis.com/maps/api/staticmap";if(b.url){p=b.url;delete b.url}p+="?";var m=b.markers;delete b.markers;if(!m&&b.marker){m=[b.marker];delete b.marker}var o=b.polyline;delete b.polyline;if(b.center){i.push("center="+b.center);delete b.center}else if(b.address){i.push("center="+b.address);delete b.address}else if(b.lat){i.push(["center=",b.lat,",",b.lng].join(""));delete b.lat;delete b.lng}else if(b.visible){var k=
encodeURI(b.visible.join("|"));i.push("visible="+k)}if(k=b.size){if(k.join)k=k.join("x");delete b.size}else k="630x300";i.push("size="+k);if(!b.zoom)b.zoom=15;k=b.hasOwnProperty("sensor")?!!b.sensor:true;delete b.sensor;i.push("sensor="+k);for(var l in b)b.hasOwnProperty(l)&&i.push(l+"="+b[l]);if(m)for(k=0;b=m[k];k++){l=[];if(b.size&&b.size!=="normal")l.push("size:"+b.size);else b.icon&&l.push("icon:"+encodeURI(b.icon));b.color&&l.push("color:"+b.color.replace("#","0x"));b.label&&l.push("label:"+
b.label[0].toUpperCase());b=b.address?b.address:b.lat+","+b.lng;if(l.length||k===0){l.push(b);l=l.join("|");i.push("markers="+encodeURI(l))}else{l=i.pop()+encodeURI("|"+b);i.push(l)}}if(o){b=o;o=[];b.strokeWeight&&o.push("weight:"+parseInt(b.strokeWeight,10));if(b.strokeColor){m=e(b.strokeColor,b.strokeOpacity);o.push("color:"+m)}if(b.fillColor){m=e(b.fillColor,b.fillOpacity);o.push("fillcolor:"+m)}m=b.path;if(m.join)for(b=0;l=m[b];b++)o.push(l.join(","));else o.push("enc:"+m);o=o.join("|");i.push("path="+
encodeURI(o))}i=i.join("&");return p+i};if(!google.maps.Polygon.prototype.getBounds)google.maps.Polygon.prototype.getBounds=function(){for(var b=new google.maps.LatLngBounds,e=this.getPaths(),i,p=0;p<e.getLength();p++){i=e.getAt(p);for(var m=0;m<i.getLength();m++)b.extend(i.getAt(m))}return b};google.maps.Polygon.prototype.containsLatLng=function(b){var e=this.getBounds();if(e!==null&&!e.contains(b))return false;e=false;for(var i=this.getPaths().getLength(),p=0;p<i;p++)for(var m=this.getPaths().getAt(p),
o=m.getLength(),k=o-1,l=0;l<o;l++){var a=m.getAt(l);k=m.getAt(k);if(a.lng()<b.lng()&&k.lng()>=b.lng()||k.lng()<b.lng()&&a.lng()>=b.lng())if(a.lat()+(b.lng()-a.lng())/(k.lng()-a.lng())*(k.lat()-a.lat())<b.lat())e=!e;k=l}return e};google.maps.LatLngBounds.prototype.containsLatLng=function(b){return this.contains(b)};google.maps.Marker.prototype.setFences=function(b){this.fences=b};google.maps.Marker.prototype.addFence=function(b){this.fences.push(b)};return q}(jQuery);
